# åŸºäºpythonçš„è‹±è¯­å‘éŸ³ä¾‹å¥åº“æ¥å£ï¼šè¯¦ç»†è®¾è®¡è¯´æ˜ä¹¦

**Pythonè¯¾ç¨‹è®¾è®¡å°ç»„ï¼šå¼ ä¸€é¸£ï¼Œå¼ æ™“è‰ºï¼Œæ½˜æ˜Š**

**ç»„é•¿ï¼šå¼ ä¸€é¸£**

## æ–‡æ¡£ä¿®æ”¹è®°å½•



| ç‰ˆæœ¬å· | ç‰ˆæœ¬æè¿°     | è´£ä»»äºº | æ—¥æœŸ      | å¤‡æ³¨ |
| ------ | ------------ | ------ | --------- | ---- |
| V1.0   | åˆå§‹ç¼–åˆ¶     | å¼ ä¸€é¸£ | 2020-6-16  |      |

## 1.å½±ç‰‡è‡ªåŠ¨è£åˆ‡æ¨¡å—

### 1.1 æ–‡ä»¶å…³ç³»

![æ–‡ä»¶å…³ç³»è§†å›¾](https://www.z4a.net/images/2020/06/26/pyfilm-spliter.png)

### 1.2 å¼•ç”¨

é¢„è®¡å¼•ç”¨**å¤–éƒ¨åº“**ï¼š

| åº“åç§° | ä½œç”¨ |
| ----- | --- |
| pymysql | è¿æ¥æ•°æ®åº“ |
| moviepy | åˆ†å‰²ã€è½¬æ¢å½±ç‰‡ |

### 1.3 ä¸»ç¨‹åº

å¯¹æŒ‡å®šä½ç½®çš„å­—å¹•è¿›è¡Œåˆ†æï¼Œå¹¶å¯»æ‰¾å…¶å…±åŒç›®å½•ä¸‹çš„ç”µå½±åˆ‡å‰²ä¸ºéŸ³é¢‘æ–‡ä»¶ï¼ŒåŒæ—¶å°†åˆ†æç»“æœä¸Šä¼ åˆ°æ•°æ®åº“ã€‚

```python
#program.py
# åœ¨å½“å‰è·¯å¾„å†™å…¥æ‰§è¡Œç»“æœ
def write_doc(content_str: str):
    pass

#ä¸»å‡½æ•°ï¼Œä¿å­˜é”™è¯¯ä¿¡æ¯
if __name__=='__main__':
    pass

```

**æ³¨ï¼šç¨‹åºå¯åŠ¨éœ€è¦æ¥å—ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼ˆsetting.xmlï¼‰å…¶æ ‡å‡†å¦‚ä¸‹ï¼š**

```xml
<?xml version="1.0" encoding="utf-8" ?>
<setting>
    <description>
        <app>pyfilm-spliter</app>
        <ver>1.0</ver>
    </description>
    <path>
        <caption_path>è¿™é‡Œå¡«å†™å­—å¹•ä¸å¯¹åº”è§†é¢‘çš„ç›®å½•</caption_path>
        <audio_path>è¿™é‡Œå¡«å†™éŸ³é¢‘è¾“å‡ºç›®å½•</audio_path>
    </path>
    <database>
        <server>æ•°æ®åº“åœ°å€</server>
        <user>æ•°æ®åº“ç”¨æˆ·å</user>
        <password>æ•°æ®åº“å¯†ç </password>
        <db_name>æ•°æ®åº“å</db_name>
    </database>
</setting>
```

### 1.4 åˆ†æå™¨

å­—å¹•åˆ†ææ¨¡å—ï¼Œæ— æ³•ç‹¬ç«‹è¿è¡Œ

```python
#analyser.analyser.py
class Analyser:
    @property
    def sentence_list(self):
        return self.__sentence_list

    @sentence_list.setter
    def sentence_list(self, value):
        self.__sentence_list = value

    @property
    def word_list(self):
        return self.__word_list

    @word_list.setter
    def word_list(self, value):
        self.__word_list = value

    #åˆå§‹åŒ–åˆ†æå™¨
    def __init__(self, start_id: int = 0):
        pass

    # ä»ä¾‹å¥ä¸­åˆ†å‰²å‡ºå•è¯å¹¶ä¿å­˜
    def __split_word(self, sentence: data_connector.model_sentence.ModelSentence):
        pass

    # è§£æxmlæ–‡ä»¶
    def __decode_xml(self):
        pass

```

```python
#analyser.tick.py
# ä¸€ä¸ªé‡æ„çš„æ—¶é—´ç±»ï¼Œé€šè¿‡strå¯ä»¥å¾—åˆ°moviepyè£åˆ‡ç”µå½±çš„æ ‡å‡†æ—¶åˆ»å­—ç¬¦ä¸²
class Tick:

    @property
    def hour(self):
        return self.__hour

    @hour.setter
    def hour(self, value: int):
        self.__hour = value

    @property
    def min(self):
        return self.__min

    @min.setter
    def min(self, value: int):
        self.__min = value

    @property
    def sec(self):
        return self.__sec

    @sec.setter
    def sec(self, value: int):
        self.__sec = value

    @property
    def min_sec(self):
        return self.__min_sec

    @min_sec.setter
    def min_sec(self, value: int):
        self.__min_sec = value
    
    #åˆå§‹åŒ–å„å±æ€§
    def __init_prop(self, tick_string: str):
        pass

    def __init__(self, tick_string: str=None):
        pass

    #å°†å­—å¹•æ–‡ä»¶çš„ç²¾ç¡®åˆ°å°æ•°ç‚¹åä¸‰ä½çš„æ—¶é—´æ•°æ®è½¬æ¢ä¸ºç²¾ç¡®åˆ°å°æ•°ç‚¹åä¸¤ä½ï¼Œä¾¿äºå½±ç‰‡åˆ‡å‰²æ¨¡å—è£åˆ‡è§†é¢‘
    def __sub_digital(self, num: int):
        pass

    #å°†æ—¶é—´æ‰“å°ä¸ºæ ‡å‡†å½¢å¼
    def __str__(self):
        pass
    
    #é‡æ„åŠ æ³•ï¼Œæ–¹ä¾¿å¥å­çš„åˆå¹¶
    def __add__(self, other):
        pass

```

```python
#analyser.caption.py
class Caption:
    @property
    def id(self):
        return self.__id

    @id.setter
    def id(self, value: int):
        self.__id = value

    @property
    def start_tick(self):
        return self.__start_tick

    @start_tick.setter
    def start_tick(self, value: Tick):
        self.__start_tick = value

    @property
    def end_tick(self):
        return self.__end_tick

    @end_tick.setter
    def end_tick(self, value: Tick):
        self.__end_tick = value

    @property
    def english(self):
        return self.__english

    @english.setter
    def english(self, value: str):
        self.__english = value

    @property
    def chinese(self):
        return self.__chinese

    @chinese.setter
    def chinese(self, value: str):
        self.__chinese = value

    åˆå§‹åŒ–å„å±æ€§
    def __init_prop(self,caption_str: str):
        pass

    @singledispatch
    def __init__(self, caption_str: str=None):
        pass

    #é‡æ„åŠ æ³•ï¼Œä¾¿äºå¥å­åˆå¹¶
    def __add__(self, other):
        pass

    #é‡æ„è¿”å›å¸ƒå°”å€¼ï¼Œæ–¹ä¾¿åˆ¤æ–­æ˜¯å¦ä¸ºç©º
    def __bool__(self):
        pass

    #ç›´æ¥è¿”å›è‹±æ–‡ï¼Œæ–¹ä¾¿åˆ¤æ–­åŒ…å«å…³ç³»
    def __str__(self):
        pass

```

```python
#analyser.caption_factory.py

class CaptionFactory:

    # è½½å…¥å¹¶è§£æä¸€ä¸ªsrtå­—å¹•æ–‡ä»¶ï¼Œè½½å…¥å‰æœ€å¥½ç”¨auto_rename_toolæ¸…æ´—ä¸€ä¸‹æ–‡ä»¶å
    @staticmethod
    def load_srt_file(path: str):
        pass

    # è½½å…¥å­˜æ”¾srtå­—å¹•æ–‡ä»¶çš„è·¯å¾„ï¼Œæ­¤è·¯å¾„çš„æ‰€æœ‰srtæ–‡ä»¶å°†è¢«è½½å…¥ï¼ŒåŒæ—¶æŸ¥æ‰¾è¯¥è·¯å¾„ä¸‹çš„ç”µå½±ï¼Œæœ‰åˆ™è¢«åˆ†å‰²ä¸ºéŸ³é¢‘ä¾‹å¥æ–‡ä»¶
    @staticmethod
    def load_dir(path: str, id: int, audio_path: str):
        pass

    # å¯»æ‰¾pathè·¯å¾„ä¸‹ä¸srt_nameåç§°ç›¸åŒçš„mp4æ–‡ä»¶ï¼ˆç”µå½±ï¼‰
    @staticmethod
    def __find_film(path, srt_name):
        pass

    # è½½å…¥å­—å¹•æ–‡ä»¶ï¼ŒåŒæ—¶åˆ†æå…¶å­—ç¬¦ç¼–ç ï¼Œç¡®ä¿æ²¡æœ‰ä¹±ç ã€‚
    @staticmethod
    def __load_file(path: str):
        pass

    # è¿‡æ»¤å¥å­ï¼Œç­›é€‰æ‰ä¸èƒ½åŠ å…¥æ•°æ®åº“çš„å¥å­ã€‚
    @staticmethod
    def __filter(sentence: str):
        pass

    # å»ºç«‹ä¾‹å¥åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨å°†è¢«analyser.pyç”¨äºåˆ†æå•è¯
    @staticmethod
    def __build_sentence_list(id: int, caption_list: list, f_name: str, source_film: str=None, target_audio: str=None):
        pass

    #åˆ¤æ–­å¥å­çš„éš¾åº¦
    @staticmethod
    def __judge_level(s: str):
        pass

```

```python
#analyser.caption_merger.py

class CaptionMerger:
    @property
    def merge_result(self):
        return self.__merge_result

    def __init__(self):
        pass

    #åˆå¹¶å¥å­
    def merge_caption(self, c: Caption):
        pass
```

### 1.5 æ•°æ®åº“è¿æ¥å™¨

æ•°æ®åº“è¿æ¥æ¨¡å—ï¼Œæ— æ³•ç‹¬ç«‹è¿è¡Œ

```python
#data_connector.model.py
from abc import ABCMeta, abstractmethod


# æŠ½è±¡ç±»Modelï¼Œä¸å¯è¢«å®ä¾‹åŒ–ï¼Œè§„å®šäº†æ‰€æœ‰Modelå­ç±»å…±åŒæ‹¥æœ‰çš„ç¯å¢ƒï¼ˆå³æ•°æ®åº“æ“ä½œæ‰€éœ€è¦çš„ç¯å¢ƒï¼‰
class Model(metaclass=ABCMeta):

    # å°†ç›®å‰çš„å¯¹è±¡è½¬åŒ–ä¸ºæ’å…¥sqlæŒ‡ä»¤ï¼ˆinsert into ....ï¼‰
    @abstractmethod
    def to_sql(self):
        pass

```

```python
#data_connector.model_sentence.py

class ModelSentence(data_connector.model.Model):
    @property
    def s_id(self):
        return self.__s_id

    @s_id.setter
    def s_id(self, value: int):
        self.__s_id = value

    @property
    def s_en(self):
        return self.__s_en

    @s_en.setter
    def s_en(self, value: str):
        self.__s_en = value

    @property
    def s_cn(self):
        return self.__s_cn

    @s_cn.setter
    def s_cn(self, value: str):
        self.__s_cn = value

    @property
    def s_voice(self):
        return self.__s_voice

    @s_voice.setter
    def s_voice(self, value: str):
        self.__s_voice = value

    @property
    def s_level(self):
        return self.__s_level

    @s_level.setter
    def s_level(self, value: int):
        self.__s_level = value

    @property
    def f_name(self):
        return self.__f_name

    @f_name.setter
    def f_name(self, value: str):
        self.__f_name = value

    def to_sql(self):
        pass

    #è½½å…¥å±æ€§
    def __init__(self, id: int, caption: analyser.caption.Caption, f_name: str, level: int, voice_path: str = None):
        pass

```

```python
#data_connector.model_word
import data_connector.model


class ModelWord(data_connector.model.Model):
    @property
    def word(self):
        return self.__word

    @word.setter
    def word(self, value: str):
        self.__word = value

    @property
    def translation(self):
        return self.__translation

    @translation.setter
    def translation(self, value: str):
        self.__translation = value

    @property
    def sentences(self):
        return self.__sentences

    @sentences.setter
    def sentences(self, value: str):
        self.__sentences = value

    def to_sql(self):
        pass

    #è½½å…¥å±æ€§
    def __init__(self, word: str, sentences: str, trans: str):
        pass

```

```python
#data_connector.data_manager.py
import pymysql


class DataManager:

    #åˆå§‹åŒ–è¿æ¥å­—ç¬¦ä¸²
    def __init__(self, db_setting: dict):
        pass

    # ä¸æ•°æ®åº“å»ºç«‹è¿æ¥
    def build_connection(self):
        pass

    # æ‰§è¡ŒsqlæŒ‡ä»¤ï¼Œæ³¨æ„åªå¯ä»¥æ‰§è¡Œéœ€è¦commitçš„æŒ‡ä»¤ï¼Œæ¯”å¦‚selectæŸ¥è¯¢ç­‰ä¸èƒ½ä½¿ç”¨ã€‚
    def execute_sql(self, sql: str):
        pass

    # åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢å•è¯é‡Šä¹‰
    def get_translation(self, word: str):
        pass

    # å…³é—­ä¸æ•°æ®åº“çš„è¿æ¥
    def close_connection(self):
        pass

```

### 1.6 å½±ç‰‡åˆ†å‰²å™¨

å°†å½±ç‰‡åˆ†å‰²ä¸ºéŸ³é¢‘æ®µçš„æ¨¡å—ï¼Œæ— æ³•ç‹¬ç«‹è¿è¡Œ

```python
#film_spliter.spliter.py
import moviepy.editor

class Spliter:

    #å°†è§†é¢‘æŒ‰ç…§æ—¶é—´åˆ†è§£ä¸ºéŸ³é¢‘ç‰‡æ®µ
    @staticmethod
    def split_to_mp3(film_path: str, target_path: str, caption: analyser.caption.Caption):
        pass

```

## 2.åç«¯äº¤äº’æ¨¡å—

### 2.1 æ–‡ä»¶å…³ç³»

![æ–‡ä»¶å…³ç³»è§†å›¾](https://www.z4a.net/images/2020/06/26/word_api.png)

### 2.2 å¼•ç”¨

é¢„è®¡å¼•ç”¨**å¤–éƒ¨åº“**ï¼š

| åº“åç§° | ä½œç”¨ |
| ----- | --- |
| pymysql | è¿æ¥æ•°æ®åº“ |
| flask | åç«¯æœåŠ¡å™¨æ¡†æ¶ |

### 2.3 receive.py

```python
class Security:
    #åˆå§‹åŒ–Security
    #ä¼ å…¥ç”¨æˆ·åã€MD5ï¼ˆkey+æ—¶é—´æˆ³ï¼‰ã€æ—¶é—´æˆ³
    def __init__(self,security_dict):
        self.uname=security_dict['uname']
        self.key=security_dict['key']
        self.time=security_dict['time']
        
        
class Option:
    #åˆå§‹åŒ–Option
    #ä¼ å…¥ä¾‹å¥éš¾åº¦
    def __init__(self,option_dict):
        self.level=option_dict['level']
        
        
class Receive:
    #åˆå§‹åŒ–æ¥æ”¶ç±»
    #ä¼ å…¥æ¥æ”¶çš„å‚æ•°
    def __init__(self,receive_dict):
        self.security=Security(receive_dict['security'])
        self.word=receive_dict['word']
        self.option=Option(receive_dict['option'])
        
```

### 2.4 send.py

```python
class Sentence:
    #åˆå§‹åŒ–ä¾‹å¥
    #ä¼ å…¥è‹±æ–‡ã€ä¸­æ–‡ä¾‹å¥å’ŒéŸ³é¢‘æ–‡ä»¶åœ°å€
    def __init__(self,f_name,en,cn,voice):
        self.f_name=f_name
        self.en=en
        self.cn=cn
        self.voice=voice
        
class Send:
    #åˆå§‹åŒ–å‘é€ç±»
    #ä¼ å…¥çŠ¶æ€ç ã€æŸ¥è¯¢å•è¯ã€ä¸­æ–‡é‡Šä¹‰å’Œä¾‹å¥åˆ—è¡¨
    def __init__(self,statue,word,trans,sentence_list):
        self.statue=statue
        self.word=word
        self.trans=trans
        self.sentences=sentence_list
    
    #å°†ç›®å‰å¯¹è±¡è½¬æ¢ä¸ºå­—å…¸
    def to_dict(self):
    	pass
```

### 2.5 db_manager.py

```python
class Db_Manager:
    self.__host="localhost" #hoståœ°å€
    self.__port=3306 #ç«¯å£å·
    self.__user="root" #ç”¨æˆ·å
    self.__password="123456" #å¯†ç 
    self.__db="water" #æ•°æ®åº“å
    
    #è¿æ¥æ•°æ®åº“
    #è¿”å›è¿æ¥
    def __connect(self):
        pass
        
    #å¾—åˆ°æ•°æ®
    #ä¼ å…¥è¿æ¥
    #è¿”å›æ¸¸æ ‡
    def get_data(conn):
        pass
    
    #å¾—åˆ°è¦å‘é€çš„æ•°æ®
    #è¿”å›Sendç±»
    def get_send_data(receive):
        pass
        
    #å¾—åˆ°ç”¨æˆ·ä¿¡æ¯
    #ä¼ å…¥ç”¨æˆ·å
    #è¿”å›å¯†é’¥
    def get_user_data(uname):
        pass
        
        
```

### 2.6 check.py

```python
class Check:
    
    #å…è®¸è¶…æ—¶
    self.__over_time=5
    #è¶…æ—¶æ—¶é—´å†…è®¿é—®çš„MD5å€¼
    self.__visited_list=[]
    
    #æŸ¥è¯¢æ•°æ®åº“ï¼Œå¾—åˆ°å¯†é’¥+æ—¶é—´æˆ³çš„MD5å€¼
    def __generate_md5(self):
        pass
    
    #ç¦æ­¢äº”ç§’å‰çš„è®¿é—®
    def __check_over_time(self):
        pass
        
    #æŸ¥è¯¢å¹¶æ›´æ–°å­—å…¸ï¼Œç¦æ­¢äº”ç§’å†…é‡å¤çš„è®¿é—®
    def __check_revisit(self):
        pass
    
    #å¼€å§‹æ£€æµ‹
    def begin_check(self):
        pass
        
```

### 2.7 app.py

```python
#ä¸»äº¤äº’å‡½æ•°
#get_receive_info(raw_info):
#è°ƒç”¨Db_manager.get_send_data(ğŸ‘†)
#è¿”å› get_send_json(send)
def api_main(request):
    pass
    
#å°†ç”¨æˆ·å‘é€çš„çš„åŸå§‹jsonå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºReceiveå¯¹è±¡
def get_receive_info(raw_info):
    pass

#å°†sendå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå­—ç¬¦ä¸²
def get_send_json(send):
    json.dumps(send.to_dict())
```

---

å‚è€ƒæ–‡çŒ®ï¼š

1. ã€ŠAPIéªŒè¯ç­–ç•¥ã€‹æ¥æº

     http://www.mamicode.com/info-detail-2401631.html
     
1. ã€Špythonâ€”â€”moviepyâ€”â€”è§†é¢‘ç¼–è¾‘ã€‹æ¥æº
    
    https://www.cnblogs.com/liming19680104/p/12089656.html