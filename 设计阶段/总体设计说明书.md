# 基于python的英语发音例句库接口：总体设计说明书

**Python课程设计小组：张一鸣，张晓艺，潘昊**

**组长：张一鸣**

## 文档修改记录



| 版本号 | 版本描述     | 责任人 | 日期      | 备注 |
| ------ | ------------ | ------ | --------- | ---- |
| V1.0   | 初始编制     | 张一鸣 | 2020-6-14  |      |

## 1.文档描述

### 1.1 目标和范围

为明确软件需求、安排项目规划与进度、组织软件开发与测试，撰写本文档。

本文档供设计人员、开发人员参考。

### 1.2 项目背景

本项目名称：基于python的英语发音例句库接口。

本项目的是为完成python课程设计制作，并不用于其他用途。

本产品能按照单词分类电影中的句子，并对句子进行一定程度上的筛选、合并。用户通过调用接口获取数据。

### 1.3 定义

关键词注释：

API —— Application Programming Interface. (应用程序接口)

GUI —— Graphical User Interface. (图形用户接口)

RDS —— Relational Database Service.(关系型数据库服务)

MD5 —— MD5 Message-Digest Algorithm.(MD5讯息摘要演算法)

### 1.4 参考资料

1. 《软件工程导论》张海藩 牟永敏著

1. 《软件工程总体设计说明书》来源

   https://wenku.baidu.com/view/9c693918b7360b4c2e3f64a1.html

1. 《软件总体设计说明书》来源

   https://wenku.baidu.com/view/695d221614791711cc79174a.html
   
1. 《软件工程实例：总体设计说明书》来源

   http://www.uml.org.cn/sjms/201307305.asp
   
## 2. 总体设计

### 2.1 需求规格

本接口的基本目标是满足各英语学习软件对英语例句的需求，为了满足开发人员灵活使用，应做到以下几点要求：

1. 例句输入数据库时，应对其进行筛查，并尽量过滤满足以下情况的例句：
   1. 例句较短、对上下文有要求等没有实用价值的。
   2. 例句中含有不雅词汇的。
   3. 例句非目标语言，即非英语的。
2. 用户请求得到例句时，可以选择其难度。
3. 为提高用户体验，接口响应时间应不超过300ms。

### 2.2 运行环境

#### 2.2.1 设备

理论上支持所有可以运行python解释器的设备，但为了运行效率考虑，应至少满足以下标准：

分析程序：CPU不做要求，内存大于等于8G，配备互联网连接功能。

后端交互：CPU主频应大于3 GHz，内存大于等于4G，配备互联网连接功能。

#### 2.2.2 支持软件

python解释器版本应大于等于3.8.1，否则不保证程序正常运行。

数据库使用阿里云RDS云数据库，mysql版本为8.0。

#### 2.2.3 接口：

本项目各程序均无GUI，且不需用户进行操作，若对影片分割模块进行配置，请修改配置文件。

开发环境配备Windows 10 Professional v1909系统，由于python解释器具有跨平台性，理论上可以运行于各个系统。故不对操作系统进行要求。

## 3. 软件总体结构

### 3.1 分解视图

#### 3.1.1 影片自动裁切模块

![影片自动裁切模块视图](https://www.z4a.net/images/2020/06/26/29c49d3fb503b21928826a9657c89eee.png)

#### 3.1.2 后端交互模块

![后端交互模块视图](https://www.z4a.net/images/2020/06/26/972441d40d705a742b949b69b8f15a68.png)

### 3.2 条件限制

开发时间不超过一周，总体项目交付日期不得超过7月10日。
   
## 4. 数据结构设计

### 4.1 数据库结构

划分细则及争论见[重要数值分析报告](https://github.com/0x202036/documents/blob/master/设计阶段/重要数值分析报告.md)


**用户表(t_user)**

| 编号 | 字段名称 | 字段含义 | 字段类型 | 字段长度 | 是否主键 | 默认值 | 是否可空 |
| ---- | -------- | -------- | -------- | -------- | -------- | ------ | -------- |
| 1    | u_name   | 用户名   | Varchar  | 20       | √        |        | ×        |
| 2    | u_key    | 密钥     | Varchar  | 128      |          |        | ×        |



**单词表(t_word)**

| 编号 | 字段名称    | 字段含义                   | 字段类型 | 字段长度 | 是否主键 | 默认值 | 是否可空 |
| ---- | ----------- | -------------------------- | -------- | -------- | -------- | ------ | -------- |
| 1    | word        | 单词                       | Varchar  | 50       | √        |        | ×        |
| 2    | translation | 中文翻译                   | Text     |          |          |        | ×        |
| 3    | sentences   | 例句（例句id，用“\|”分隔） | Text     | --       |          |        | ×        |



**影片例句表(t_sentence)**

| 编号 | 字段名称 | 字段含义           | 字段类型 | 字段长度 | 是否主键 | 默认值 | 是否可空 |
| ---- | -------- | ------------------ | -------- | -------- | -------- | ------ | -------- |
| 1    | s_id     | 例句id（自动递增） | Integer  | 7        | √        |        | ×        |
| 2    | s_en     | 英文原版例句       | Text     |          |          |        | ×        |
| 3    | s_cn     | 中文翻译例句       | Text     |          |          |        | ×        |
| 4    | s_voice  | 音频文件地址       | Varchar  | 100      |          |        | √        |
| 5    | s_level  | 难度分级（0-2）    | Integer  | 1        |          | 2      | ×        |
| 6    | f_name   | 电影名称           | Varchar  | 100      |          |        | ×        |

### 4.2 数据结构设计

#### 4.2.1 影片自动裁切模块

caption（字幕）：

| 字段名 | 含义 | 类型 | 可见性 | 属性 |
| ----- | --- | --- | ----- | ---- |
| id | 字幕内ID | int | public | 读写 |
| start_tick | 字幕起始时间 | Tick | public | 读写 |
| end_tick | 字幕结束时间 | Tick | public | 读写 |
| english | 英文字幕 | string | public | 读写 |
| chinese | 中文字幕 | string | public | 读写 |

model_sentence（与数据库对接的例句类型）：

| 字段名 | 含义 | 类型 | 可见性 | 属性 |
| ----- | --- | --- | ----- | ---- |
| s_id | 例句ID | int | public | 读写 |
| s_en | 例句英文原版 | string | public | 读写 |
| s_cn | 例句中文翻译 | string | public | 读写 |
| s_voice | 音频文件地址 | string | public | 读写 |
| s_level | 例句难度 | int | public | 读写 |
| f_name | 所属电影名 | string | public | 读写 |

model_word（与数据库对接的单词类型）：

| 字段名 | 含义 | 类型 | 可见性 | 属性 |
| ----- | --- | --- | ----- | ---- |
| word | 单词 | string | public | 读写 |
| translation | 中文释义 | string | public | 读写 |
| sentences | 包含例句ID | string | public | 读写 |

#### 4.2.2 后端交互模块

Security （承接用户发来的用户验证信息类）

| 字段名 | 含义 | 类型 | 可见性 | 属性 |
| ----- | --- | --- | ----- | ---- |
| uname | 用户名 | string | public | 读写 |
| key | 由MD5加密过的用户密钥加时间戳的字符串 | string | public | 读写 |
| time | 时间戳（小数点后7位） | float | public | 读写 |

Option （承接用户发来的例句筛选请求类）

| 字段名 | 含义 | 类型 | 可见性 | 属性 |
| ----- | --- | --- | ----- | ---- |
| level | 例句难度 | int | public | 读写 |

Receive （承接用户发来的Json数据类）

| 字段名 | 含义 | 类型 | 可见性 | 属性 |
| ----- | --- | --- | ----- | ---- |
| security | 用户验证信息 | Security | public | 读写 |
| word | 用户查询的单词 | string | public | 读写 |
| Option | 用户的例句筛选请求 | Option | public | 读写 |

Sentence （要发送给用户的例句类）

| 字段名 | 含义 | 类型 | 可见性 | 属性 |
| ----- | --- | --- | ----- | ---- |
| f_name | 例句所属电影名称 | string | public | 读写 |
| en | 例句英文原版 | string | public | 读写 |
| cn | 例句中文翻译 | string | public | 读写 |
| voice | 音频文件地址 | string | public | 读写 |

Send （要发送给用户的例句类）

| 字段名 | 含义 | 类型 | 可见性 | 属性 |
| ----- | --- | --- | ----- | ---- |
| statue | 查询状态码 | int | public | 读写 |
| word | 用户查询的单词 | string | public | 读写 |
| trans | 单词释义 | string | public | 读写 |
| sentences | 查询到的例句集合 | list of Sentence | public | 读写 |

## 5.系统出错处理设计

### 5.1 电影自动裁切模块

无论程序是否正确运行，程序都会生成运行报告（runtime_doc.txt）

当程序正常运行时，报告内容如下：

```
date:程序运行日期
================================================
Done!
word_count:	共计分析单词数量
sentence_count: 共计分析例句数量
All data have been uploaded in database.
```

当程序运行异常时，报告如下：
```
date:程序运行日期
================================================
Exception Happened:
str(Exception):	异常类型
str(e):	异常信息
repr(e):    控制台异常信息
traceback.print_exc():	控制台返回信息
traceback.format_exc():
    详细异常信息
```

异常报告有助于开发人员分析错误原因，应尽可能收集。

### 5.2 后端交互模块

当程序查询出现错误或者用户操作失误时，将在状态码（statue）中返回信息，状态码的各返回值对应信息如下：

| 状态码 | 含义 |
| ---- | -------- |
| 0    | 请求成功        |
| 1    | 请求单词未录入   |
| 2    | 用户认证失败     |
| 3    | 传入数据格式错误  |

### 5.3 出错处理对策

#### 5.3.1 后端交互模块

后端交互模块的错误主要通过返回状态码告知用户。

所有的客户机及服务器都必须安装不间断电源以防止停电或电压不稳造成的数据丢失的损失。

在网络传输方面，可考虑建立一条成本较低的后备网络，以保证当主网络断路时数据的通信。

在硬件方面要选择较可靠、稳定的服务器机种，保证系统运行时的可靠性。

#### 5.3.2 影片自动裁切模块

影片自动裁切模块的错误主要通过生成运行报告提交错误。

主要交互操作及出错响应预案为：

| 对象 | 交互操作 | 处理机制 | 运行文档显示类型 |
| ---- | ------ | ------- | ------------- |
| 字幕文件 | 字幕文件的读取 | 跳过 | 警告 |
|  | 字幕文件的分解 | 跳过 | 警告 |
| 视频文件 | 视频文件的读取 | 跳过 | 警告 |
|  | 视频文件的分解 | 跳过 | 警告 |
| 音频文件 | 音频文件的写入 | 跳过 | 警告 |
| 数据库 | 数据库的连接 | 退出程序 | 警告和异常 |
|  | 数据库的读取 | 退出程序 | 警告和异常 |
|  | 数据库的上传 | 退出程序 | 警告和异常 |
| 配置文件 | 配置文件的读取 | 退出程序 | 警告和异常 |
| 模块 | 模块的调用 | 退出程序 | 异常 |


### 5.4 维护设计

维护方面主要为对服务器上的数据库进行维护。
